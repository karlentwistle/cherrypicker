#!/usr/bin/ruby
$LOAD_PATH.unshift File.join(File.dirname(__FILE__), '..', 'lib')
require 'cherrypicker'
require 'getoptlong'
require 'pathname'

def usage()
	puts "Cherrypicker lets you download from; Rapidshare, Hotfile, Youtube, Vimeo & Megavideo"
	puts "Usage: cherrypick link [--directory|-d] [--username|-u] [--password|-p]"
	puts
	puts "example: cherrypick http://www.youtube.com/watch?v=I5DCwN28y8o -d \"~/Movies\""
	puts "example: cherrypick http://rapidshare.com/files/453165880/test_file.txt -u \"karlentwistle\" -p \"foobar\""
end

if not ARGV[0]
	usage
	exit
end

#refactored by Hamac credit http://is.gd/sbxAwG
options = {username: nil, password: nil, directory: nil}

parser = GetoptLong.new 
parser.set_options(*options.keys.map{|opt| ["--#{opt.to_s}", "-#{opt.to_s[0]}", GetoptLong::REQUIRED_ARGUMENT]}
) 

parser.each{|opt, arg| options[opt.gsub('--', '').to_sym] = arg unless arg == ''}

if options[:directory] && !File.directory?(options[:directory]) then
  puts "Directory not found " + options[:directory]
  usage 
  exit
end
s
Cherrypicker::Cherrypick.new(ARGV[0], :location => options[:directory], :username => options[:username], :password => options[:password])